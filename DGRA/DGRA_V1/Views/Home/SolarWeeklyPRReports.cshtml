@using Newtonsoft.Json;
@using Microsoft.AspNetCore.Http;
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Solar Weekly Reports";
}
@{
    string windSiteList = "";
    var usermodel = JsonConvert.DeserializeObject<UserAccess>(@HttpContextAccessor.HttpContext.Session.GetString("UserAccess"));

}
@for (int i = 0; i < @usermodel.access_list.Count; i++)
{

    if (@usermodel.access_list[i].page_type == 3 && @usermodel.access_list[i].site_type == 2)
    {
        windSiteList += @usermodel.access_list[i].identity.ToString() + ",";
    }
}
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet" href="~/Content/theme/plugins/fontawesome-free/css/all.min.css">
<!-- daterange picker -->
<link rel="stylesheet" href="~/Content/theme/plugins/daterangepicker/daterangepicker.css">
<!-- DataTables -->
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
<link rel="stylesheet" href="~/Content/theme/plugins/jquery/jquery.min.js">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables/jquery.dataTables.min.js">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-responsive/js/dataTables.responsive.min.js">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-buttons/js/dataTables.buttons.min.js">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-buttons/js/buttons.colVis.min.js">
@*<script type="text/javascript">
        alert("This alert box was called with the onload event");
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>
    <link href="https://code.jquery.com/jquery-3.5.1.js" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js" rel="stylesheet">*@

@*In addition to the above code, the following Javascript library files are loaded for use in this example:

    https://code.jquery.com/jquery-3.5.1.js
    https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js
    https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js
    https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js
    https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js*@

<!-- dropdown search -->
<link href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script>



<link href="~/Content/theme/dist/css/adminlte.css" rel="stylesheet" />
<style>
    .tab-btn {
        font-size: 0.7rem;
        font-weight: bold;
    }

    .card-body {
    }

    hr {
        margin-top: -10px !important;
    }
</style>

<div class="content-wrapper">

    <section class="content-header">
    </section>

    <section class="content">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title text-center">Solar Weekly Performance Reports</h3>
            </div>


            <div class="card-body">
                <div class="tab-content" id="custom-tabs-two-tabContent">
                    <div class="tab-pane fade show active" id="custom-tabs-two-op" role="tabpanel" aria-labelledby="custom-tabs-two-op-tab">
                        <div class="row">
                            <!--<div class="col-sm-4">
                                <div class="form-group">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label text-right">FY : </label>
                                        <select class="form-control  col-sm-8" id="fy" name="fy" value="">
                                            <option value="">Select Financial Year</option>
                                        </select>
                                    </div>
                                </div>
                            </div>-->
                            <div class="col-sm-4">
                                <div class="input-group ">
                                    <label class="col-sm-2 col-form-label text-left">Date : </label>
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="far fa-calendar-alt"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="form-control float-right col-sm-6" id="daterange" name="daterange">
                                </div>
                            </div>

                            <div class="col-sm-2">
                                <button type="button" class="btn btn-block btn-primary" onclick="GetOperationWKPR();" style="margin-left:-2rem; width: 5rem;">Search</button>
                            </div>
                            <div class="col-sm-6"></div>

                        </div>
                        <br>
                        <hr>
                        <div id="loader" class="loader  center" style="display:none"></div>
                        <div id="divHFE">
                            <div class="row" id="wk_head" style="display:none">
                                <div class="col-sm-5 text-center" id="wk_head_sec1">

                                </div>
                                <div class="col-sm-3" id="wk_head_sec2">

                                </div>
                                <div class="col-sm-4" id="wk_head_sec3">

                                </div>

                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="chart col-sm-4" style="padding:10px;">
                                <canvas id="energy_mu_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-4" style="padding:10px;">
                                <canvas id="wind_sp_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-4" style="padding:10px;">
                                <canvas id="plf_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                        </div>
                        <hr>

                        <div class="row">

                            <div class="chart col-sm-4 " style="padding:10px;">
                                <canvas id="ma_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-4" style="padding:10px;">
                                <canvas id="ega_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-4" style="padding:10px;">
                                <canvas id="iga_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                        </div>
                        <hr>

                        <br>
                        <div id="divPBS">
                            <div class="card-header">
                                <h3 class="card-title text-center">Performance By Site</h3>
                            </div>
                            <br>
                            <div id="reportsDailySite" style="overflow-x: auto;" class="reportsDailySite"></div>
                        </div>
                        <br>
                        <div class="row" id="sitewisechart">
                            <div class="chart col-sm-6 text-center">
                                <!--<h5>Energy (MUs) </h5>-->
                                <canvas id="energy_chart_pr_site" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-6 text-center">
                                <!--<h5>PR (%)</h5>-->
                                <canvas id="wind_chart_pr_site" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                            </div>

                        </div>
                        <br>
                        <div id="divPSPV">
                            <div class="card-header">
                                <h3 class="card-title text-center">Performance By SPV</h3>
                            </div>
                            <br>
                            <div id="reportsDailySPV" style="overflow-x: auto;" class="reportsDailySPV"></div>
                        </div>
                        <br>
                        <div class="row" id="sitewisechart">
                            <div class="chart col-sm-6 text-center">
                                <!--<h5>Energy (MUs) </h5>-->
                                <canvas id="energy_chart_pr_spv" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                            </div>
                            <div class="chart col-sm-6 text-center">
                                <!--<h5>PR (%)</h5>-->
                                <canvas id="wind_chart_pr_spv" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                            </div>

                        </div>
                        <hr>
                        <div id="divMBR">
                            <div class="card-header">
                                <h5 class="card-title text-center">Major Breakdown Reports</h5>
                            </div>
                            <br>
                            <div id="reportsMonthly" style="overflow-x: auto;" class="reportsMonthly"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!--<div class="card-footer">
            Footer
        </div>-->




    </section>

</div>
<script src="~/Content/theme/plugins/jquery/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="~/Content/theme/plugins/moment/moment.min.js"></script>
<script src="~/Content/theme/plugins/daterangepicker/daterangepicker.js" defer></script>
<script src="~/Content/theme/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>

<script src="~/Content/theme/plugins/summernote/summernote-bs4.min.js"></script>
<!--Datatable -->
<script src="~/Content/theme/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="~/Content/theme/plugins/datatables/jquery.dataTables.js" defer></script>

<script src="~/Content/theme/plugins/datatables-buttons/js/dataTables.buttons.min.js" defer></script>
<script src="~/Content/theme/plugins/jszip/jszip.min.js" defer></script>
<script src="~/Content/theme/plugins/datatables-buttons/js/buttons.html5.min.js" defer></script>
<script src="~/Content/theme/plugins/pdfmake/pdfmake.min.js" defer></script>
<script src="~/Content/theme/plugins/datatables-buttons/js/buttons.colVis.min.js" defer></script>

<script src="~/Content/theme/plugins/chart.js/Chart.min.js"></script>
<script src="~/Content/theme/dist/js/comman.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0-rc"></script>


<!--PPT-->

<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.11.0/libs/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.11.0/dist/pptxgen.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script type="text/javascript">
    var fyear ="";
    $(document).ready(function () {
        $('#daterange').daterangepicker(
            {
                singleDatePicker: true,
                maxDate: new Date(),
                locale: {
                    format: 'DD/MM/YYYY',
                }
            });

    });

    window.onload = function () {
        var today = new Date();
        fyear = getFinancialYear(today);
        //getYear();
        let dateRangeInput = "";
        //console.log(window.location.href);
        var url = window.location.href;
        const urlSplit = url.split("?");
        //console.log(urlSplit);
        if (urlSplit.length > 1) {

            dateRange = urlSplit[1];
            let dateSplit = dateRange.split("-");
            $('#daterange').data('daterangepicker').setStartDate(dateSplit[0]);
            GetOperationWKPR();
            //$('#daterange').data('daterangepicker').setDate(dateSplit[0])

            //$('#daterange').data('daterangepicker').setEndDate(dateSplit[1]);
        }
    }
    var actual_mu = [];
    var target_mu = [];
    var var_mu_pos = [];
    var var_mu_neg = [];

    var actual_pr = [];
    var target_pr = [];
    var var_pr_pos = [];
    var var_pr_neg = [];
    var actual_ghi = [];
    var target_ghi = [];
    var var_ghi_pos = [];
    var var_ghi_neg = [];
    var actual_poa = [];
    var target_poa = [];
    var var_poa_pos = [];
    var var_poa_neg = [];
    var actual_plf = [];
    var target_plf = [];
    var var_plf_pos = [];
    var var_plf_neg = [];
    var actual_ma = [];
    var target_ma = [];
    var var_ma_pos = [];
    var var_ma_neg = [];
    var actual_iga = [];
    var target_iga = [];
    var var_iga_pos = [];
    var var_iga_neg = [];
    var actual_ega = [];
    var target_ega = [];
    var var_ega_pos = [];
    var var_ega_neg = [];
    var Diff_Mus = [];
    var revenue = [];
    var imgHFE = "";
    var imgPBS = "";
    var imgPSPV = "";
    var imgMBR = "";
    var ChartImages = [];
    var HFECharts = [];
    //ChartImages.push(pptTheme);
    /*function getYear() {
    $.ajax({
        type: "GET",
        url: "/WindReport/GetFinacialYear",
        contentType: "application/json; charset=utf-8",
        datatype: "html",
        success: function (result, status, xhr) {
            var options = "";
            options += '<option value="">Select Financial Year</option>';
            for (var i = 0; i < result.length; i++) {
                options += '<option value="' + result[i].financial_year + '">' + result[i].financial_year + '</option>';
            }
            $("#fy").html(options);
            $("#fy1").html(options);
            $('select#fy').multipleSelect({
                filter: true
            })
            $('select#fy1').multipleSelect({
                filter: true
            })
        }
    });
    }*/


    function GetOperationWKPR() {
        var a = document.getElementById("loader");
        console.log(document.getElementById("loader").style.display);
        a.style.display = 'flex';
        console.log(document.getElementById("loader").style.display);
        GetPerformanceBySPV();
        GetPerformanceBySite();
        MajorBreakdown();
        var tar_energy_wk = 0;
        var act_energy_wk = 0;
        var energy_var_wk =0
        var tar_pr_wk = 0;
        var act_pr_wk = 0;
        var pr_var_wk = 0;
        var tar_ghi_wk = 0;
        var act_ghi_wk = 0;
        var ghi_var_wk = 0;
        var tar_poa_wk = 0;
        var act_poa_wk = 0;
        var poa_var_wk = 0;
        var tar_plf_wk = 0;
        var act_plf_wk = 0;
        var plf_var_wk = 0;
        var tar_ma_wk = 0;
        var act_ma_wk = 0;
        var ma_var_wk = 0;
        var tar_iga_wk = 0;
        var act_iga_wk = 0;
        var iga_var_wk = 0;
        var tar_ega_wk = 0;
        var act_ega_wk = 0;
        var ega_var_wk = 0;
        var total_revenue_wk = 0;
        var diff_MUs_wk = 0;
        var total_capacity = 0;
        var total_tarriff_wk = 0;
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fy = fyear;//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetWeeklyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=1',
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {
                actual_mu = [];
                target_mu = [];
                var_mu_pos = [];
                var_mu_neg = [];
                actual_pr = [];
                target_pr = [];
                var_pr_pos = [];
                var_pr_neg = [];
                actual_ghi = [];
                target_ghi = [];
                var_ghi_pos = [];
                var_ghi_neg = [];
                actual_poa = [];
                target_poa = [];
                var_poa_pos = [];
                var_poa_neg = [];
                actual_plf = [];
                target_plf = [];
                var_plf_pos = [];
                var_plf_neg = [];
                actual_ma = [];
                target_ma = [];
                var_ma_pos = [];
                var_ma_neg = [];
                actual_iga = [];
                target_iga = [];
                var_iga_pos = [];
                var_iga_neg = [];
                actual_ega = [];
                target_ega = [];
                var_ega_pos = [];
                var_ega_neg = [];
                Diff_Mus = [];
                revenue = [];

                for (var i = 0; i < result.length; i++) {
                    total_capacity += result[i].capacity;
                    tar_energy_wk += result[i].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_wk += result[i].act_kwh;
                    //total_minr += minr;
                    total_tarriff_wk += result[i].total_tarrif;
                    tar_ghi_wk += result[i].tar_ghi * result[i].capacity;
                    act_ghi_wk += result[i].act_ghi * result[i].capacity;

                    tar_poa_wk += result[i].tar_poa * result[i].capacity;
                    act_poa_wk += result[i].act_poa * result[i].capacity;
                    console.log();
                    tar_plf_wk += result[i].tar_plf * result[i].capacity;
                    act_plf_wk += result[i].act_plf * result[i].capacity;
                    //total_capTarPr += result[i].tar_pr * result[i].capacity;
                   //total_capTarGain += gain_tar * result[i].capacity;
                    tar_ma_wk += result[i].tar_ma * result[i].capacity;
                    act_ma_wk += result[i].act_ma * result[i].capacity;

                    tar_iga_wk += result[i].tar_iga * result[i].capacity;
                    act_iga_wk += result[i].act_iga * result[i].capacity;

                    tar_ega_wk += result[i].tar_ega * result[i].capacity;
                    act_ega_wk += result[i].act_ega * result[i].capacity;
                    total_revenue_wk += (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                   //act_ma_wk += act_prval * result[i].capacity;
                    //total_capActGain += gain_act * result[i].capacity;
                }

                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity != 0) {
                    if (tar_ghi_wk != 0 || act_ghi_wk != 0) {
                        avg_tar_ghi = tar_ghi_wk / total_capacity;
                        avg_act_ghi = act_ghi_wk / total_capacity;
                    }

                    if (tar_plf_wk != 0 || act_plf_wk != 0) {
                        avg_tar_plf = tar_plf_wk / total_capacity;
                        avg_act_plf = act_plf_wk / total_capacity;
                    }
                    if (tar_poa_wk != 0 || tar_poa_wk != 0) {
                        avg_tar_poa = tar_poa_wk / total_capacity;
                        avg_act_poa = act_poa_wk / total_capacity;
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_wk != 0 || act_ma_wk != 0) {
                        avg_tar_ma = tar_ma_wk / total_capacity;
                        avg_act_ma = act_ma_wk / total_capacity;
                    }
                    if (tar_iga_wk != 0 || act_iga_wk != 0) {
                        avg_tar_iga = tar_iga_wk / total_capacity;
                        avg_act_iga = act_iga_wk / total_capacity;
                    }
                    if (tar_ega_wk != 0 || act_ega_wk != 0) {
                        avg_tar_ega = tar_ega_wk / total_capacity;
                        avg_act_ega = act_ega_wk / total_capacity;
                    }
                   //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }

                if (tar_energy_wk != 0) {
                    energy_var_wk = (((act_energy_wk - tar_energy_wk) / tar_energy_wk) * 100);
                }
                if (tar_poa_wk != 0) {
                    poa_var_wk = (((avg_act_poa - avg_tar_poa) / avg_tar_poa) * 100);
                }
                ghi_var_wk = (avg_act_ghi - avg_tar_ghi);
               // poa_var_wk = (avg_act_poa - avg_tar_poa);
               //avg_pr_var = (avg_act_pr - avg_tar_pr);
               // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_wk = (avg_act_plf - avg_tar_plf);
                ma_var_wk = (avg_act_ma - avg_tar_ma);
                iga_var_wk = (avg_act_iga - avg_tar_iga);
                ega_var_wk = (avg_act_ega - avg_tar_ega);

                //Energy
                let en_pasitive;
                let en_negative;
                if (energy_var_wk < 0) {
                    en_negative = (energy_var_wk ).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_wk).toFixed(1);
                }

                diff_MUs_wk = (act_energy_wk - tar_energy_wk);
                Diff_Mus.push(diff_MUs_wk.toFixed(1));
                revenue.push(total_revenue_wk);
                actual_mu.push(act_energy_wk.toFixed(1));
                target_mu.push(tar_energy_wk.toFixed(1));

                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_wk < 0) {
                    ghi_negative = (ghi_var_wk).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_wk).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA

                let poa_positive;
                let poa_negative;
                if (poa_var_wk < 0) {
                    poa_negative = (poa_var_wk).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_wk).toFixed(1);
                }

                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);

                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_wk < 0) {
                    plf_negative = plf_var_wk.toFixed(1);
                }
                else {
                    plf_positive = plf_var_wk.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion

                let ma_positive;
                let ma_negative;
                if (ma_var_wk < 0) {
                    ma_negative = ma_var_wk.toFixed(1);
                }
                else {
                    ma_positive = ma_var_wk.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_wk < 0) {
                    iga_negative = iga_var_wk.toFixed(1);
                }
                else {
                    iga_positive = iga_var_wk.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation

                let ega_positive;
                let ega_negative;
                if (ega_var_wk < 0) {
                    ega_negative = ega_var_wk.toFixed(1);
                }
                else {
                    ega_positive = ega_var_wk.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);
                GetOperationMonthlyPR();


            }

        });

        //document.getElementById("loader").style.display = 'none';

    }

    function GetOperationMonthlyPR() {
        var tar_energy_mn= 0;
        var act_energy_mn = 0;
        var energy_var_mn = 0
        var tar_pr_mn = 0;
        var act_pr_mn = 0;
        var pr_var_mn = 0;
        var tar_ghi_mn = 0;
        var act_ghi_mn = 0;
        var pr_ghi_mn = 0;
        var tar_poa_mn = 0;
        var act_poa_mn = 0;
        var pr_poa_mn = 0;
        var tar_plf_mn = 0;
        var act_plf_mn = 0;
        var plf_var_mn = 0;
        var tar_ma_mn = 0;
        var act_ma_mn = 0;
        var ma_var_mn = 0;
        var tar_iga_mn = 0;
        var act_iga_mn = 0;
        var iga_var_mn = 0;
        var tar_ega_mn = 0;
        var act_ega_mn = 0;
        var ega_var_mn = 0;
        var total_revenue_mn = 0;
        var diff_MUs_mn = 0;
        var total_capacity_mn = 0;
        var total_tarriff_mn = 0;
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var setDate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        //console.log(toDate);
        var monthdate = GetMonthDate(setDate);
        //console.log("Start Date :", monthdate.startdate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fromDate = monthdate.startdate;
        var dateForFy = new Date(toDate);
        var fy = getFinancialYear(dateForFy);//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetMontlyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=2',
            //url: "/WindReport/GetMontlyOperation?fy=" + fy + "&fromDate=" + fromDate + "&toDate=" + toDate + "&site=" + site_ids,
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {


                for (var j = 0; j < result.length; j++) {
                    total_capacity_mn += result[j].capacity;
                    tar_energy_mn += result[j].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_mn += result[j].act_kwh;
                    //total_minr += minr;
                    total_tarriff_mn += result[j].total_tarrif;
                    tar_ghi_mn += result[j].tar_ghi * result[j].capacity;
                    act_ghi_mn += result[j].act_ghi * result[j].capacity;

                    tar_poa_mn += result[j].tar_poa * result[j].capacity;
                    act_poa_mn += result[j].act_poa * result[j].capacity;

                    tar_plf_mn += result[j].tar_plf * result[j].capacity;
                    act_plf_mn += result[j].act_plf * result[j].capacity;
                    //total_capTarPr += result[j].tar_pr * result[j].capacity;
                    //total_capTarGain += gain_tar * result[j].capacity;
                    tar_ma_mn += result[j].tar_ma * result[j].capacity;
                    act_ma_mn += result[j].act_ma * result[j].capacity;

                    tar_iga_mn += result[j].tar_iga * result[j].capacity;
                    act_iga_mn += result[j].act_iga * result[j].capacity;

                    tar_ega_mn += result[j].tar_ega * result[j].capacity;
                    act_ega_mn += result[j].act_ega * result[j].capacity;
                    total_revenue_mn += (result[j].act_kwh - result[j].tar_kwh) * result[j].total_tarrif;
                    //act_ma_wk += act_prval * result[j].capacity;
                    //total_capActGain += gain_act * result[j].capacity;
                }

                console.log("Target POA: " + tar_poa_mn);
                console.log("Act POA: " + act_poa_mn);
                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity_mn != 0) {
                    if (tar_ghi_mn != 0 || act_ghi_mn != 0) {
                        avg_tar_ghi = tar_ghi_mn / total_capacity_mn;
                        avg_act_ghi = act_ghi_mn / total_capacity_mn;
                    }

                    if (tar_plf_mn != 0 || act_plf_mn != 0) {
                        avg_tar_plf = tar_plf_mn / total_capacity_mn;
                        avg_act_plf = act_plf_mn / total_capacity_mn;
                    }
                    if (tar_poa_mn != 0 || act_poa_mn != 0) {

                        avg_tar_poa = tar_poa_mn / total_capacity_mn;
                        avg_act_poa = act_poa_mn / total_capacity_mn;
                        console.log("avg_tar_poa " + avg_tar_poa);
                        console.log("avg_act_poa " + avg_act_poa);
                        console.log("total_capacity_mn " + total_capacity_mn);
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_mn != 0 || act_ma_mn != 0) {
                        avg_tar_ma = tar_ma_mn / total_capacity_mn;
                        avg_act_ma = act_ma_mn / total_capacity_mn;
                    }
                    if (tar_iga_mn != 0 || act_iga_mn != 0) {
                        avg_tar_iga = tar_iga_mn / total_capacity_mn;
                        avg_act_iga = act_iga_mn / total_capacity_mn;
                    }
                    if (tar_ega_mn != 0 || act_ega_mn != 0) {
                        avg_tar_ega = tar_ega_mn / total_capacity_mn;
                        avg_act_ega = act_ega_mn / total_capacity_mn;
                    }
                    //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }
                if (tar_energy_mn != 0) {
                    energy_var_mn = (((act_energy_mn - tar_energy_mn) / tar_energy_mn) * 100);
                }
                if (tar_poa_mn != 0) {
                    poa_var_mn = (((avg_act_poa - avg_tar_poa) / avg_tar_poa) * 100);
                }
                ghi_var_mn = (avg_act_ghi - avg_tar_ghi);
               // poa_var_mn = (avg_act_poa - avg_tar_poa);
                //avg_pr_var = (avg_act_pr - avg_tar_pr);
                // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_mn = (avg_act_plf - avg_tar_plf);
                ma_var_mn = (avg_act_ma - avg_tar_ma);
                iga_var_mn = (avg_act_iga - avg_tar_iga);
                ega_var_mn = (avg_act_ega - avg_tar_ega);


                revenue.push( total_revenue_mn );
                // Push Energy MU Monthly
                diff_MUs_mn = (act_energy_mn - tar_energy_mn);
                Diff_Mus.push(diff_MUs_mn.toFixed(1));

                //Energy
                let en_pasitive;
                let en_negative;
                if (energy_var_mn < 0) {
                    en_negative = (energy_var_mn).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_mn).toFixed(1);
                }


                actual_mu.push(act_energy_mn.toFixed(1));
                target_mu.push(tar_energy_mn.toFixed(1));
                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_mn < 0) {
                    ghi_negative = (ghi_var_mn).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_mn).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA

                let poa_positive;
                let poa_negative;
                if (poa_var_mn < 0) {
                    poa_negative = (poa_var_mn).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_mn).toFixed(1);
                }

                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);

                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_mn < 0) {
                    plf_negative = plf_var_mn.toFixed(1);
                }
                else {
                    plf_positive = plf_var_mn.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion

                let ma_positive;
                let ma_negative;
                if (ma_var_mn < 0) {
                    ma_negative = ma_var_mn.toFixed(1);
                }
                else {
                    ma_positive = ma_var_mn.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_mn < 0) {
                    iga_negative = iga_var_mn.toFixed(1);
                }
                else {
                    iga_positive = iga_var_mn.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation

                let ega_positive;
                let ega_negative;
                if (ega_var_mn < 0) {
                    ega_negative = ega_var_mn.toFixed(1);
                }
                else {
                    ega_positive = ega_var_mn.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);
                GetOperationYearlyPR();

                //document.getElementById("loader").style.display = 'none';
                // Call function for get yearly data
            }
        });
    }
    function GetOperationYearlyPR() {

        var tar_energy_yr = 0;
        var act_energy_yr = 0;
        var energy_var_yr = 0
        var tar_pr_yr = 0;
        var act_pr_yr = 0;
        var pr_var_yr = 0;
        var tar_ghi_yr = 0;
        var act_ghi_yr = 0;
        var pr_ghi_yr = 0;
        var tar_poa_yr = 0;
        var act_poa_yr = 0;
        var pr_poa_yr = 0;
        var poa_var_yr = 0;
        var tar_plf_yr = 0;
        var act_plf_yr = 0;
        var plf_var_yr = 0;
        var tar_ma_yr = 0;
        var act_ma_yr = 0;
        var ma_var_yr = 0;
        var tar_iga_yr = 0;
        var act_iga_yr = 0;
        var iga_var_yr = 0;
        var tar_ega_yr = 0;
        var act_ega_yr = 0;
        var ega_var_yr = 0;
        var total_revenue_yr = 0;
        var diff_MUs_yer = 0;
        var total_capacity_yr = 0;
        var total_tarriff_yr = 0;
       // var fy = fyear;//$('select#fy option:selected').val();
       
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var dateForFy = new Date(toDate);
        var fy = getFinancialYear(dateForFy);
        var FyDate = getFinancialYearDate(fy);
        var FyDate1 = FyDate.startdate;
        const fydateArr = FyDate1.split("-");
        var fromDate = `${fydateArr[2]}-${fydateArr[1]}-${fydateArr[0]}`;
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetYearlyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=3',
            //url: "/WindReport/GetMontlyOperation?fy=" + fy + "&fromDate=" + fromDate + "&toDate=" + toDate + "&site=" + site_ids,
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {


                for (var k = 0; k < result.length; k++) {
                    total_capacity_yr += result[k].capacity;
                    tar_energy_yr += result[k].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_yr += result[k].act_kwh;
                    //total_minr += minr;
                    total_tarriff_yr += result[k].total_tarrif;
                    tar_ghi_yr += result[k].tar_ghi * result[k].capacity;
                    act_ghi_yr += result[k].act_ghi * result[k].capacity;

                    tar_poa_yr += result[k].tar_poa * result[k].capacity;
                    act_poa_yr += result[k].act_poa * result[k].capacity;

                    tar_plf_yr += result[k].tar_plf * result[k].capacity;
                    act_plf_yr += result[k].act_plf * result[k].capacity;
                    //total_capTarPr += result[k].tar_pr * result[k].capacity;
                    //total_capTarGain += gain_tar * result[k].capacity;
                    tar_ma_yr += result[k].tar_ma * result[k].capacity;
                    act_ma_yr += result[k].act_ma * result[k].capacity;

                    tar_iga_yr += result[k].tar_iga * result[k].capacity;
                    act_iga_yr += result[k].act_iga * result[k].capacity;

                    tar_ega_yr += result[k].tar_ega * result[k].capacity;
                    act_ega_yr += result[k].act_ega * result[k].capacity;
                    total_revenue_yr += (result[k].act_kwh - result[k].tar_kwh) * result[k].total_tarrif;
                    //act_ma_wk += act_prval * result[i].capacity;
                    //total_capActGain += gain_act * result[i].capacity;
                }

                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity_yr != 0) {
                    if (tar_ghi_yr != 0 || act_ghi_yr != 0) {
                        avg_tar_ghi = tar_ghi_yr / total_capacity_yr;
                        avg_act_ghi = act_ghi_yr / total_capacity_yr;
                    }

                    if (tar_plf_yr != 0 || act_plf_yr != 0) {
                        avg_tar_plf = tar_plf_yr / total_capacity_yr;
                        avg_act_plf = act_plf_yr / total_capacity_yr;
                    }
                    if (tar_poa_yr != 0 || act_poa_yr != 0) {
                        avg_tar_poa = tar_poa_yr / total_capacity_yr;
                        avg_act_poa = act_poa_yr / total_capacity_yr;
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_yr != 0 || act_ma_yr != 0) {
                        avg_tar_ma = tar_ma_yr / total_capacity_yr;
                        avg_act_ma = act_ma_yr / total_capacity_yr;
                    }
                    if (tar_iga_yr != 0 || act_iga_yr != 0) {
                        avg_tar_iga = tar_iga_yr / total_capacity_yr;
                        avg_act_iga = act_iga_yr / total_capacity_yr;
                    }
                    if (tar_ega_yr != 0 || act_ega_yr != 0) {
                        avg_tar_ega = tar_ega_yr / total_capacity_yr;
                        avg_act_ega = act_ega_yr / total_capacity_yr;
                    }
                    //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }

                if (tar_energy_yr != 0) {
                    energy_var_yr = (((act_energy_yr - tar_energy_yr) / tar_energy_yr) * 100);
                }
                if (tar_poa_yr != 0) {
                    poa_var_yr = (((avg_act_poa - avg_tar_poa) / avg_tar_poa) * 100);
                }
                ghi_var_yr = (avg_act_ghi - avg_tar_ghi);
               // poa_var_yr = (avg_act_poa - avg_tar_poa);
                //avg_pr_var = (avg_act_pr - avg_tar_pr);
                // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_yr = (avg_act_plf - avg_tar_plf);
                ma_var_yr = (avg_act_ma - avg_tar_ma);
                iga_var_yr = (avg_act_iga - avg_tar_iga);
                ega_var_yr = (avg_act_ega - avg_tar_ega);


                //Energy
                let en_pasitive;
                let en_negative;
                if (energy_var_yr < 0) {
                    en_negative = (energy_var_yr).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_yr).toFixed(1);
                }

                revenue.push(total_revenue_yr);
                // Push Energy MU Monthly
                diff_MUs_yr = (act_energy_yr - tar_energy_yr);
                Diff_Mus.push(diff_MUs_yr.toFixed(1));

                actual_mu.push(act_energy_yr.toFixed(1));
                target_mu.push(tar_energy_yr.toFixed(1));

                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_yr < 0) {
                    ghi_negative = (ghi_var_yr).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_yr).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA

                let poa_positive;
                let poa_negative;
                if (poa_var_mn < 0) {
                    poa_negative = (poa_var_yr).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_yr).toFixed(1);
                }

                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);

                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_yr < 0) {
                    plf_negative = plf_var_yr.toFixed(1);
                }
                else {
                    plf_positive = plf_var_yr.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion

                let ma_positive;
                let ma_negative;
                if (ma_var_yr < 0) {
                    ma_negative = ma_var_yr.toFixed(1);
                }
                else {
                    ma_positive = ma_var_yr.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_yr < 0) {
                    iga_negative = iga_var_yr.toFixed(1);
                }
                else {
                    iga_positive = iga_var_yr.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation

                let ega_positive;
                let ega_negative;
                if (ega_var_yr < 0) {
                    ega_negative = ega_var_yr.toFixed(1);
                }
                else {
                    ega_positive = ega_var_yr.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);
                // Call Cahrd Functions
                //console.log("Actual MU" + actual_mu);
                //console.log("target_mu" + target_mu);
                //console.log("var_mu_pos" + var_mu_pos);
                //console.log("var_mu_neg" + var_mu_neg);

                //console.log("actual_poa" + actual_poa);
                //console.log("target_poa" + target_poa);
                //console.log("var_poa_pos" + var_poa_pos);
                //console.log("var_poa_neg" + var_poa_neg);

                //console.log("actual_plf" + actual_plf);
                //console.log("target_plf" + target_plf);
                //console.log("var_plf_pos" + var_plf_pos);
                //console.log("var_plf_neg" + var_plf_neg);

                //console.log("actual_ma" + actual_ma);
                //console.log("target_ma" + target_ma);
                //console.log("var_ma_pos" + var_ma_pos);
                //console.log("var_ma_neg" + var_ma_neg);

                //console.log("actual_iga" + actual_iga);
                //console.log("target_iga" + target_iga);
                //console.log("var_iga_pos" + var_iga_pos);
                //console.log("var_iga_neg" + var_iga_neg);

                //console.log("actual_ega" + actual_ega);
                //console.log("target_ega" + target_ega);
                //console.log("var_ega_pos" + var_ega_pos);
                //console.log("var_ega_neg" + var_ega_neg);
                chartEnergyMU(actual_mu, target_mu, var_mu_pos, var_mu_neg);
                console.log(target_mu[0] + " " + target_mu[1] + " " + target_mu[2]);
                chartIR(actual_poa, target_poa, var_poa_pos, var_poa_neg);
                PLF_chart(actual_plf, target_plf, var_plf_pos, var_plf_neg);
                MA_chart(actual_ma, target_ma, var_ma_pos, var_ma_neg);
                IGA_chart(actual_iga, target_iga, var_iga_pos, var_iga_neg);
                EGA_chart(actual_ega, target_ega, var_ega_pos, var_ega_neg);

                OperationalTable(Diff_Mus, revenue);
                var url = window.location.href;
                const urlSplit = url.split("?");
                //console.log(urlSplit);
                console.log(ChartImages);
                if (urlSplit.length > 1) {
                    setTimeout(function () {
                        console.log(ChartImages);
                        makePPT(ChartImages);
                    }, 15000);
                }
            }
        });

    }
    async function makePPT(ChartImages) {

        let pres = new PptxGenJS();
        //pres.addText('Note : Reports for Performance By Site, Performance By SPV  is limited to column MA Actual(%), Major Breakdown Reports limited to 10 records due to truncate of data.', { x: 0, y: '90%', w: '100%', h: 50, align: 'center' });
        //Add HFE data

        HFECharts = [...new Set(HFECharts)];
        console.log('HFECharts')
        console.log(HFECharts)
        console.log('Before length of chart image :- '+ChartImages.length)
        ChartImages = [...new Set(ChartImages)];

        ChartImages.splice(1, 0, imgHFE);
        ChartImages.splice(5, 0, imgPSPV);
        ChartImages.splice(15, 0, imgPBS);
        ChartImages.splice(16, 0, imgMBR);

        ChartImages.splice(2, 0, ...HFECharts);




        //// 2. Add a Slide
        //let slide1 = pres.addSlide();

        //let opts = {
        //    x: 0.0,
        //    y: 0.25,
        //    w: "100%",
        //    h: 1.5,
        //    align: 'center',
        //    fontSize: 24,
        //    color: "F00000",
        //    fill: "000000"
        //}



        const thankyouSlide = `data:image/png;base64,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`
        ChartImages.push(thankyouSlide);
        console.log('ChartImages');
        console.log(ChartImages);


                let temp = ChartImages[12]; // Store 11th element in temp variable
        ChartImages[12] = ChartImages[7]; // Assign 11th element to 5th position
        ChartImages[7] = temp;


        ChartImages.forEach(function (currentValue, index, arr) {
            if(index == 1 ){
                console.log(1);
 //pres.addSlide().addImage({
 //               path: currentValue,
 //               x: "0%",
 //               y: "0%",
 //               w: "100%",
 //               h: "50%",
 //           })
        //    .addText("Note : Reports for Performance By Site, Performance By SPV  is limited to column PLF(%), Major Breakdown Reports limited to 10 records due to truncate of data.", {
        //    x: "0%",
        //    y: "70%",
        //    fontSize: 24,
        //    color: "FF0000",
        //    align: "center",
        //});

            }
            else if(index == 2 ) {

             pres.addSlide().addImage({
                path: ChartImages[index+5],
                x: "33%",
                y: "70%",
                w: "30%",
                h: "30%",
            }).addImage({
                path: ChartImages[index],
                x: "63%",
                y: "70%",
                w: "30%",
                h: "30%",
            }).addImage({
                path: ChartImages[index-1],
                x: "0%",
                y: "0%",
                w: "100%",
                h: "23%",
            }).addImage({
                path: ChartImages[index+1],
                x: "0%",
                y: "30%",
                w: "30%",
                h: "30%",
            }).addImage({
                path: ChartImages[index+2],
                x: "33%",
                y: "30%",
                w: "30%",
                h: "30%",
            }).addImage({
                path: ChartImages[index+3],
                x: "66%",
                y: "30%",
                w: "30%",
                h: "30%",
            }).addImage({
                path: ChartImages[index+4],
                x: "0%",
                y: "70%",
                w: "30%",
                h: "30%",
            });

         }
         else if(index > 2 && index <9 ){
             console.log(index);
         }
         else if (index == 9) {
              pres.addSlide().addImage({
                path: ChartImages[index+1],
                x: "0%",
                y: "0%",
                w: "100%",
                h: "100%",
            })
              pres.addSlide().addImage({
                           path: ChartImages[12],
                           x: "0%",
                           y: "0%",
                           w: "100%",
                           h: "50%",
                       }).addImage({
                           path: ChartImages[8],
                           x: "0%",
                           y: "50%",
                           w: "100%",
                           h: "50%",
                       })
         }
         else if(index == 10){
            //             pres.addSlide().addImage({
            //     path: ChartImages[index+1],
            //     x: "0%",
            //     y: "0%",
            //     w: "100%",
            //     h: "50%",
            // }).addImage({
            //    path: ChartImages[index-1],
            //    x: "0%",
            //    y: "50%",
            //    w: "100%",
            //    h: "50%",
            //});
         }
         else if(index > 10 && index <13 ){
             console.log(index);
         }
         else if(index == ChartImages.length-2) {
             // this for before chart images before breAKDOWN
               pres.addSlide().addImage({
                 path: ChartImages[10+1],
                 x: "0%",
                 y: "0%",
                 w: "100%",
                 h: "50%",
             }).addImage({
                path: ChartImages[10-1],
                x: "0%",
                y: "50%",
                w: "100%",
                h: "50%",
            });
                pres.addSlide().addImage({
                path: currentValue,
                x: "0%",
                y: "0%",
                w: "100%",
                h: "100%",
            });
         }
         else{
                pres.addSlide().addImage({
                path: currentValue,
                x: "0%",
                y: "0%",
                w: "100%",
                h: "100%",
            });
         }

//            else if(index==0||index==5||index==13||index==14||index==15){
//pres.addSlide().addImage({
//                path: currentValue,
//                x: "0%",
//                y: "0%",
//                w: "100%",
//                h: "100%",
//            });
//            }else{
//pres.addSlide().addImage({
//                path: currentValue,
//                    x: "20%",
//                    y: "20%",
//                    w: "65%",
//                    h: "70%",
//            });
//            }

        });

        // 4. Save the Presentation
        /*Promise(pres.writeFile()).then((values) =>{
            var url = window.location.href;
            const urlSplit = url.split("?");
            console.log(urlSplit);
            if(urlSplit.length>1){
                window.close();
        }
        })*/
        //pres.writeFile();
        let today = new Date().toISOString().slice(0, 10)
        var fname = 'SolarWeeklyReport_' + today;
        await pres.writeFile({
            fileName: fname,
        });
        setTimeout(() => {
            MailCall(fname);
            setTimeout(() => {
                window.close();
            }, 2000)
        }, 2000);


        /*var url = window.location.href;
        const urlSplit = url.split("?");
        console.log(urlSplit);
        if(urlSplit.length>1){
            window.close();
        }*/
    }
    function MailCall(fname) {
        //$.ajax({
        //    type: "GET",
        //    // url: "/WindReport/GetSPVList?state=" + val,
        //    url: '@Url.Action("MailSend", "SolarReport")' + '?fname=' + fname,
        //    contentType: "application/json; charset=utf-8",
        //    //data: '{"state":"' + val + '"}',
        //    datatype: "html",

        //    success: function (result, status, xhr) {
        //        return 1;
        //    }
        //});
    }
    function OperationalTable(Diff_Mus, revenue) {
        var wind_side = "@Html.Raw(windSiteList.TrimEnd(','))";
        const site_array = wind_side.split(",");
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
         $.ajax({
            type: "GET",
           // url: "/WindReport/GetSPVList?state=" + val,
             url: '@Url.Action("GetOperationHeadData", "SolarReport")' + '?site=' + wind_side,
            contentType: "application/json; charset=utf-8",
            //data: '{"state":"' + val + '"}',
             datatype: "html",

             success: function (result, status, xhr) {
                 var sec1 = "";
                 var sec2 = "";
                 var sec3 = "";
                 sec1 += '<p>&nbsp</p><h4 class="dark-blue" style="font-weight: bold;">HFE Operational Performance</h4>';
                 //sec1 += '<p class="dark-blue" style="font-weight: bold;">(' + fromDate + ' to ' + toDate + ')</p>';

                 sec2 += '<table class="table table-bordered table-striped">';
                 sec2 += '<thead class="tbl-head"><tr>';
                 sec2 += '<th colspan="2"></th></tr><thead>';
                 sec2 += '<tr><td>Portfolio</td><td style="text-align: right;">' + site_array.length + '</td></tr>';
                 sec2 += '<tr><td>SPVs</td><td style="text-align: right;">' + result[0].spv_count + '</td></tr>';
                 sec2 += '<tr><td>Capacity (in MW)</td><td style="text-align: right;">' + result[0].capacity.toFixed(0) + '</td></tr>';
                 sec2 += '</table>';


                 sec3 += '<table class="table table-bordered table-striped" style="line-height: 15px;">';
                 sec3 += '<thead class="tbl-head"><tr>';
                 sec3 += '<th>Period</th><th>Energy Gain/Loss (MUs)	</th><th>(±)Revenue (MINR)</th></tr ></thead> ';
                 sec3 += '<tr><td>WK</td><td style="text-align: right;">' + Diff_Mus[0] + '</td><td style="text-align: right;">' + revenue[0].toFixed(1) + '</td></tr>';
                 sec3 += '<tr><td>MTD</td><td style="text-align: right;">' + Diff_Mus[1] + '</td><td style="text-align: right;">' + revenue[1].toFixed(1) + '</td></tr>';
                 sec3 += '<tr><td>YTD</td><td style="text-align: right;">' + Diff_Mus[2] + '</td><td style="text-align: right;">' + revenue[2].toFixed(1) + '</td></tr></table>';

                 $("#wk_head_sec1").html(sec1);
                 $("#wk_head_sec2").html(sec2);
                 $("#wk_head_sec3").html(sec3);

                 //document.getElementById('spv_counts').innerHTML = result[0].spv_count;
                //document.getElementById('capacity').innerHTML = result[0].capacity.toFixed(0);
                var table = document.getElementById('divHFE');
                html2canvas(table).then(function (canvas) {
                    // Get the image data as a URL
                    var imageData = canvas.toDataURL();
                    imgHFE = imageData;

                });

            }
         });

        //document.getElementById('portfolio').innerHTML = site_array.length;
        document.getElementById('wk_head').style.display = 'flex';
    }
    function chartEnergyMU(actual_mu, target_mu, var_mu_pos, var_mu_neg) {

        let chartStatus = Chart.getChart("energy_mu_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("energy_mu_chart"), {
            type: 'bar',
            data: {
                labels: ["WK","MTD","YTD"],
                datasets: [{
                    yAxisID: 'en_mu',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_mu,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'en_mu',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_mu,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'mu_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_mu_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'mu_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_mu_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy(MUs)",

                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);

                        ChartImages.push(url1);
                    }
                },
                scales: {
                    en_mu: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    mu_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //Wind Spped Chart
    function chartIR(actual_wind, target_wind, var_wind_pos, var_wind_neg) {
        let chartStatus = Chart.getChart("wind_sp_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("wind_sp_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ir_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ir_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ir_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_wind_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'ir_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_wind_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        //ChartImages.push(url1);
                        if (!HFECharts.includes(url1)) {
                           HFECharts.push(url1);
                        }

                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irradiance (kWh/m^2)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ir_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ir_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }

    //PLF Chart
    function PLF_chart(actual_plf, target_plf, var_plf_pos, var_plf_neg) {
        let chartStatus = Chart.getChart("plf_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("plf_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'plf_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_plf,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'plf_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_plf,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'plf_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_plf_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'plf_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_plf_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        //ChartImages.push(url1);
                        if (!HFECharts.includes(url1)) {
                           HFECharts.push(url1);
                        }
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "PLF (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    plf_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    plf_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //MA  Chart
    function MA_chart(actual_ma, target_ma, var_ma_pos, var_ma_neg) {
        let chartStatus = Chart.getChart("ma_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("ma_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ma_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_ma,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ma_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_ma,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                },{
                    yAxisID: 'ma_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_ma_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ma_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_ma_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        //ChartImages.push(url1);
                        if (!HFECharts.includes(url1)) {
                           HFECharts.push(url1);
                        }
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "MA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ma_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ma_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //IGA  Chart
    function IGA_chart(actual_iga, target_iga, var_iga_pos, var_iga_neg) {
        let chartStatus = Chart.getChart("iga_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("iga_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'iga_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_iga,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'iga_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_iga,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'iga_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_iga_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'iga_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_iga_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        //ChartImages.push(url1);
                        if (!HFECharts.includes(url1)) {
                           HFECharts.push(url1);
                        }
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "IGA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    iga_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    iga_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //EGA  Chart
    function EGA_chart(actual_ega, target_ega, var_ega_pos, var_ega_neg) {
        let chartStatus = Chart.getChart("ega_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        var sampleChart = new Chart(document.getElementById("ega_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ega_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_ega,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ega_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_ega,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ega_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_ega_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'ega_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_ega_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        //ChartImages.push(url1);
                        if (!HFECharts.includes(url1)) {
                           HFECharts.push(url1);
                        }
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "EGA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ega_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ega_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
   // -----------------------------------Weekly ---------------------//
    function MajorBreakdown() {
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var dateForFy = new Date(toDate);
        var fyear1 = getFinancialYear(dateForFy);
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarMajorBreakdown", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids,
            //url: "/WindReport/GetWindPRReportSPVWise?fy=" + fyear + " &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",

            datatype: "JSON",
            success: function (result, status, xhr) {
                //console.log(result);
                var tbl = '<table id="example2"  class="table table-bordered table-striped" >';
                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th>Date</th>';
                tbl += '<th>Site</th>';
                tbl += '<th>ICRs</th>';
                tbl += '<th>INVs</th>'
                tbl += '<th>BD Type</th>';
                tbl += '<th>Total Stop</th>';
                tbl += '<th>Reason of Breakdown</th>';
                tbl += '</tr></thead>';
                if (result.length > 0) {
                    //var total_time = "";
                    for (var i = 0; i < result.length; i++) {
                        var formattedDate = moment(result[i].date, 'YYYY/MM/DD').format('DD-MM-YYYY');

                                tbl += '<tr>';
                                tbl += '<td class="text-left">' + formattedDate + '</td>';
                                tbl += '<td class="text-left">' + result[i].site + '</td>';
                                location_name = "Plant Shutdown";
                        if (result[i].icr_cnt ) {
                            tbl += '<td class="text-left">' + result[i].icr_cnt + ' ICRs</td>';
                            tbl += '<td class="text-left">' + result[i].inv_cnt + ' INVs</td>';
                        } else {
                            tbl += '<td class="text-left">' + result[i].icr + '</td>';
                            tbl += '<td class="text-left">' + result[i].inv + '</td>';
                        }
                                tbl += '<td class="text-left">' + result[i].bd_type + '</td>';
                                tbl += '<td class="text-left">' + result[i].total_bd.toFixed(2) + '</td>';
                                tbl += '<td class="text-left">' + result[i].bd_remarks + '</td>';
                            }

                }
                else {
                    //console.log("Data not available");
                    // tbl += '<tr><th colspan="12" style="text-align:center">Data Not Available <th></tr>';
                }
                tbl += '</table>';
                //$("#reportsDaily1").html("").html(tbl);
                $("#reportsMonthly").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example2').DataTable({
                    dom: 'Bfrtip',
                    title: 'ImportApproval',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: false,
                    paging: true,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: false,
                    pageLength:50,
                    buttons: [
                        {
                            extend: 'excel',
                            title: 'Solar Major Breakdown Reports',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        {
                            extend: 'csv',
                            title: 'Solar Major Breakdown Reports',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        'colvis'
                    ]
                    /* "buttons": [
                         'copy', 'excel', 'csv', 'colvis'
                     ]*/
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm');
                $(document).on("click", "div.dt-button-collection > div > button", function () {
                    if ($(this).hasClass("active")) {
                        $(this).css("background-color", "white");
                    } else {
                        $(this).css("background-color", "#31576d");
                    }
                });
                $('#example2').removeClass('dataTable');

                var divMBR = document.getElementById('divMBR');
                html2canvas(divMBR).then(function (canvas) {
                    // Get the image data as a URL
                    var imageData = canvas.toDataURL();
                    imgMBR = imageData;
                });
            }
        });

    }


    // Mothly Report WTG Wise

    function GetPerformanceBySPV() {

        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var dateForFy = new Date(toDate);
        var fyear1 = getFinancialYear(dateForFy);
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        var actual_energy = [];
        var target_energy = [];
        var pas_energy_var = [];
        var neg_energy_var = [];

        var actual_pr = [];
        var target_pr = [];
        var pas_pr_var = [];
        var neg_pr_var = [];
        var Levels = [];

        var revenue_arr = [];
        var reporthead = "SPV Wise Reports";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarPRReportSPVWise", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&sitelist=' + site_ids,
            //url: "/WindReport/GetWindPRReportSPVWise?fy=" + fyear + " &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",

            datatype: "JSON",
            success: function (result, status, xhr) {
               // console.log(result);
                //var tbl = '<div class="text-center"><h5>' + reporthead+'</h5></div>';

                var tbl = '<table id="example4"  class="table table-bordered table-striped" style="width:150%">';
                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th rowspan="2">Site</th><th  rowspan="2">Capacity <br>(MW)</th>';
                tbl += '<th colspan="5" class="text-center">Gen nos. (MUs)</th><th>(±)Revenue</th>';
                tbl += '<th colspan="3" class="text-center">GHI (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">POA (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">GHI Vs POA Gain%</th>';
                tbl += '<th colspan="3" class="text-center">PLF (%)</th>';
                tbl += '<th colspan="3" class="text-center">PR (%)</th>';

                tbl += '<th colspan="3" class="text-center">Temp Corr. PR (%)</th>';

                tbl += '<th colspan="3" class="text-center">MA Actual (%)</th><th colspan="3" class="text-center">IGA (%)</th>';
                tbl += '<th colspan="3" class="text-center">EGA (%)</th></tr>';
                // tbl += '<tr><th>&nbsp;</th>';

                tbl += '<tr><th>Tar</th>';
                tbl += '<th>Exp</th>';
                tbl += '<th>Act JMR</th>';
                tbl += '<th>T.Var (%)</th>';
                tbl += '<th>E.Var (%)</th>';

                tbl += '<th>(MINR)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '</tr></thead>';


                if (result.length > 0) {
                    //console.log("Datatable");
                    let total_capacity = 0;
                    let total_tar_kwh = 0;
                    let total_act_kwh = 0;
                    let total_expected_kwh = 0;
                    let total_revenue = 0;
                    let total_capTarGhi = 0;
                    let total_tar_ghi = 0;
                    let total_act_ghi = 0;
                    let total_capTarPlf = 0;
                    let total_tar_plf = 0;
                    let total_act_plf = 0;
                    let total_capTarGain = 0;
                    let total_tar_gain = 0;
                    let total_act_gain = 0;
                    let total_capTarPoa = 0;
                    let total_tar_poa = 0;
                    let total_act_poa = 0;
                    let total_capTarPr = 0;
                    let total_tar_pr = 0;
                    let total_act_pr = 0;
                    let total_capTarMa = 0;
                    let total_tar_ma = 0;
                    let total_act_ma = 0;
                    let total_capTarIga = 0;
                    let total_tar_iga = 0;
                    let total_act_iga = 0;
                    let total_capTarEga = 0;
                    let total_tar_ega = 0;
                    let total_act_ega = 0;
                    let total_capActGhi = 0;
                    let total_capActPlf = 0;
                    let total_capActGain = 0;
                    let total_capActPoa = 0;
                    let total_capActPr = 0;
                    let total_capActMa = 0;
                    let total_capActIga = 0;
                    let total_capActEga = 0;

                    let total_capTarTCPr = 0;
                    let total_capActTCPr = 0;
                    let total_tar_TCpr = 0;
                    let total_act_TCpr = 0;


                    for (var i = 0; i < result.length; i++) {
                        Levels.push(result[i].spv);
                        let revenue = 0;
                        let jmr_var = 0;
                        let e_var = 0;
                        let plf_var = 0;
                        let ma_act_var = 0;
                        let iga_var = 0;
                        let ega_var = 0;
                        revenue = (result[i].act_jmr_kwh_mu - result[i].tar_kwh_mu) * result[i].total_tarrif;
                        let ghi_var = 0;
                        let poa_var = 0;
                        let pr_var = 0;
                        let gain_tar = 0;
                        let gain_act = 0;
                        let gain_var = 0;
                        let act_prval = 0;

                        let TCPr_var = 0;

                        revenue = (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                        if (result[i].act_kwh != 0 || result[i].tar_kwh != 0) {
                            jmr_var = ((result[i].act_kwh - result[i].tar_kwh) / result[i].tar_kwh) * 100;
                        }
                        if (result[i].expected_kwh != 0 || result[i].expected_kwh) {
                            e_var = ((result[i].act_kwh - (result[i].expected_kwh / 1000000)) / (result[i].expected_kwh / 1000000) * 100);
                        }
                        if (result[i].pr_expected_kwh == 0 || result[i].act_kwh == 0) {
                            act_prval = 0;
                        }
                        else {
                            act_prval = (result[i].act_kwh / result[i].pr_expected_kwh) * 100;
                        }
                        if (result[i].tar_ghi != 0) {
                            ghi_var = ((result[i].act_ghi.toFixed(2) - result[i].tar_ghi.toFixed(2)) / result[i].tar_ghi.toFixed(2)) * 100;
                        }
                        if (result[i].tar_poa != 0) {
                            poa_var = ((result[i].act_poa.toFixed(2) - result[i].tar_poa.toFixed(2)) / result[i].tar_poa.toFixed(2)) * 100;
                        }

                        TCPr_var = (result[i].temp_corrected_pr - result[i].tar_pr)

                        pr_var = (act_prval - result[i].tar_pr);
                        plf_var = (result[i].act_plf - result[i].tar_plf);
                        ma_act_var = (result[i].act_ma - result[i].tar_ma);
                        iga_var = (result[i].act_iga - result[i].tar_iga);
                        ega_var = (result[i].act_ega - result[i].tar_ega);


                        if (result[i].tar_poa == 0 || result[i].tar_ghi == 0) {
                            gain_tar = 0;
                        } else {
                            gain_tar = (result[i].tar_poa / result[i].tar_ghi) * 100;
                        }
                        if (result[i].act_poa == 0 || result[i].act_ghi == 0) {
                            gain_act = 0;
                        } else {
                            gain_act = (result[i].act_poa / result[i].act_ghi) * 100;
                        }
                        if (gain_act == 0 || gain_tar == 0) {
                            gain_var = 0;
                        } else {
                            gain_var = (gain_act.toFixed(2) - gain_tar.toFixed(2));
                        }
                        let pasitive;
                        let negative;
                        let j_pasitive;
                        let j_negative;

                        if (jmr_var < 0) {
                            negative = jmr_var.toFixed(2);
                            j_negative = jmr_var.toFixed(1);
                        }
                        else {
                            pasitive = jmr_var.toFixed(2);
                            j_pasitive = jmr_var.toFixed(1);
                        }
                        let pr_pasitive;
                        let pr_negative;
                        let p_pr_pasitive;
                        let p_pr_negative;
                        if (pr_var < 0) {
                            pr_negative = pr_var.toFixed(2);
                           // p_pr_negative = pr_var.toFixed(1);
                        }
                        else {
                            pr_pasitive = pr_var.toFixed(2);

                        }
                        if (poa_var < 0) {
                            p_pr_negative = pr_var.toFixed(1);
                        }
                        else {
                            p_pr_pasitive = pr_var.toFixed(1);
                        }
                       // console.log(result[i].tar_kwh);
                        target_energy.push((result[i].tar_kwh).toFixed(1));
                        actual_energy.push(result[i].act_kwh.toFixed(1));
                        pas_energy_var.push(j_pasitive);
                        neg_energy_var.push(j_negative);

                        //target_pr.push(result[i].tar_pr.toFixed(1));
                        //actual_pr.push(result[i].act_pr.toFixed(1));
                        //pas_pr_var.push(p_pr_pasitive);
                        //neg_pr_var.push(p_pr_negative);
                        target_pr.push(result[i].tar_poa.toFixed(1));
                        actual_pr.push(result[i].act_poa.toFixed(1));
                        pas_pr_var.push(p_pr_pasitive);
                        neg_pr_var.push(p_pr_negative);

                        revenue_arr.push(revenue.toFixed(2));

                        total_capacity += result[i].capacity;
                        total_tar_kwh += result[i].tar_kwh;
                        total_expected_kwh += result[i].expected_kwh;
                        total_act_kwh += result[i].act_kwh;
                        total_revenue += revenue;
                        total_tar_ghi += result[i].tar_ghi;
                        total_act_ghi += result[i].act_ghi;
                        total_tar_poa += result[i].tar_poa;
                        total_act_poa += result[i].act_poa;
                        total_tar_gain += gain_tar;
                        total_act_gain += gain_act;
                        total_tar_plf += result[i].tar_plf;
                        total_act_plf += result[i].act_plf;
                        total_tar_pr += result[i].tar_pr;
                        total_act_pr += act_prval;
                        total_tar_ma += result[i].tar_ma;
                        total_act_ma += result[i].act_ma;
                        total_tar_iga += result[i].tar_iga;
                        total_act_iga += result[i].act_iga;
                        total_tar_ega += result[i].tar_ega;
                        total_act_ega += result[i].act_ega;
                        total_capTarGhi += result[i].tar_ghi * result[i].capacity;
                        total_capTarPoa += result[i].tar_poa * result[i].capacity;
                        total_capTarPlf += result[i].tar_plf * result[i].capacity;
                        total_capTarPr += result[i].tar_pr * result[i].capacity;
                        total_capTarGain += gain_tar * result[i].capacity;
                        total_capTarMa += result[i].tar_ma * result[i].capacity;
                        total_capTarIga += result[i].tar_iga * result[i].capacity;
                        total_capTarEga += result[i].tar_ega * result[i].capacity;
                        total_capActGhi += result[i].act_ghi * result[i].capacity;
                        total_capActPoa += result[i].act_poa * result[i].capacity;
                        total_capActPlf += result[i].act_plf * result[i].capacity;
                        total_capActPr += act_prval * result[i].capacity;
                        total_capActGain += gain_act * result[i].capacity;
                        total_capActMa += result[i].act_ma * result[i].capacity;
                        total_capActIga += result[i].act_iga * result[i].capacity;
                        total_capActEga += result[i].act_ega * result[i].capacity;

                        total_tar_TCpr += result[i].tar_pr;
                        total_act_TCpr += result[i].temp_corrected_pr;
                        total_capTarTCPr += result[i].tar_pr * result[i].capacity;
                        total_capActTCPr += result[i].temp_corrected_pr * result[i].capacity;

                        tbl += '<tr>';
                        //tbl += '<td class="text-left">' + result[i].site + '</td>';
                        tbl += '<td class="text-left">' + result[i].spv + '</td>';
                        //tbl += '<td class="text-right">' + result[i].total_mw.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].capacity.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + (result[i].expected_kwh / 1000000).toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + jmr_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + e_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + revenue.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ghi_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + poa_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_tar.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_act.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + act_prval.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + pr_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].temp_corrected_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + TCPr_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ma_act_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + iga_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ega_var.toFixed(2) + '</td>';
                        tbl += '</tr>';
                    }
                    let avg_jmr_var = 0;
                    let avg_e_var = 0; //(((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                    let avg_tar_ghi = 0;
                    let avg_ghi_var = 0;
                    let avg_tar_plf = 0;
                    let avg_plf_var = 0;
                    let avg_tar_poa = 0;
                    let avg_poa_var = 0;
                    let avg_tar_gain = 0;
                    let avg_gain_var = 0;
                    let avg_tar_pr = 0;
                    let avg_pr_var = 0;
                    let avg_tar_ma = 0;
                    let avg_ma_var = 0;
                    let avg_tar_iga = 0;
                    let avg_iga_var = 0;
                    let avg_tar_ega = 0;
                    let avg_ega_var = 0;
                    let avg_act_ghi = 0
                    let avg_act_poa = 0;
                    let avg_act_plf = 0;
                    let avg_act_gain = 0;
                    let avg_act_pr = 0;
                    let avg_act_ma = 0;
                    let avg_act_iga = 0;
                    let avg_act_ega = 0;

                    let avg_tar_TCpr = 0;
                    let avg_TCpr_var = 0;

                    if (total_capacity != 0) {
                        avg_tar_ghi = (total_capTarGhi / total_capacity);
                        avg_tar_plf = total_capTarPlf / total_capacity;
                        avg_tar_poa = total_capTarPoa / total_capacity;
                        avg_tar_gain = total_capTarGain / total_capacity;
                        avg_tar_pr = total_capTarPr / total_capacity;
                        avg_tar_ma = total_capTarMa / total_capacity;
                        avg_tar_iga = total_capTarIga / total_capacity;
                        avg_tar_ega = total_capTarEga / total_capacity;
                        avg_act_ghi = total_capActGhi / total_capacity;
                        avg_act_plf = total_capActPlf / total_capacity;
                        avg_act_poa = total_capActPoa / total_capacity;
                        avg_act_gain = total_capActGain / total_capacity;
                        avg_act_pr = total_capActPr / total_capacity;
                        avg_act_ma = total_capActMa / total_capacity;
                        avg_act_iga = total_capActIga / total_capacity;
                        avg_act_ega = total_capActEga / total_capacity;
                        avg_tar_TCpr = total_capTarTCPr / total_capacity;
                        avg_act_TCpr = total_capActTCPr / total_capacity;
                    }
                    if (total_tar_kwh != 0) {
                        avg_jmr_var = (((total_act_kwh.toFixed(2) - total_tar_kwh.toFixed(2)) / total_tar_kwh.toFixed(2)) * 100)
                    }
                    if (total_expected_kwh != 0) {
                        avg_e_var = (((total_act_kwh.toFixed(2) - total_expected_kwh.toFixed(2)) / total_expected_kwh.toFixed(2)) * 100);
                    }
                    if (avg_tar_ghi != 0) {
                        avg_ghi_var = (((avg_act_ghi.toFixed(2) - avg_tar_ghi.toFixed(2)) / avg_tar_ghi.toFixed(2)) * 100);
                    }
                    if (avg_tar_poa != 0) {
                        avg_poa_var = (((avg_act_poa.toFixed(2) - avg_tar_poa.toFixed(2)) / avg_tar_poa.toFixed(2)) * 100);
                    }

                    avg_TCpr_var = (avg_act_TCpr.toFixed(2) - avg_tar_TCpr.toFixed(2));

                    avg_pr_var = (avg_act_pr.toFixed(2) - avg_tar_pr.toFixed(2));
                    avg_gain_var = (avg_act_gain.toFixed(2) - avg_tar_gain.toFixed(2));
                    avg_plf_var = (avg_act_plf.toFixed(2) - avg_tar_plf.toFixed(2));
                    avg_ma_var = (avg_act_ma.toFixed(2) - avg_tar_ma.toFixed(2));
                    avg_iga_var = (avg_act_iga.toFixed(2) - avg_tar_iga.toFixed(2));
                    avg_ega_var = (avg_act_ega.toFixed(2) - avg_tar_ega.toFixed(2));

                    tbl += '<tfoot><tr>';
                    tbl += '<th rowspan="1" colspan="1" style="width: 10%; font-weight: bold;">Grand Total</th>';
                    tbl += '<td class="text-right"><b>' + total_capacity.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_tar_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_expected_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_act_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_jmr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_e_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_revenue.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ghi.toFixed(2) + '</b></td>';                  
                    tbl += '<td class="text-right"><b>' + avg_act_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ghi_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_poa_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_gain_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_plf_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_pr_var.toFixed(2) + '</b></td>';

                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_TCpr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_TCpr_var.toFixed(2) + '</b></td>';

                    tbl += '<td class="text-right"><b>' + avg_tar_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ma_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_iga_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ega_var.toFixed(2) + '</b></td>';

                    tbl += '</tr></tfoot>';
                }
                else {
                    //console.log("Data not available");

                }
                tbl += '</table>';
                $("#reportsDailySPV").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example3').DataTable({
                    dom: 'Bfrtip',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: true,
                    paging: true,
                    lengthChange: false,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: true,
                    responsive: false,
                    pageLength: 50,
                    //columnDefs: [
                    //    {
                    //        targets: 1,
                    //        className: 'noVis'
                    //    }
                    //],
                   
                    buttons: [
                        {
                            extend: 'excel',
                            footer: true,
                            title: 'Solar Performance Reports Weekly SPV Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'Temp Corr. PR (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'Temp Corr. PR (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'Temp Corr. PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 32) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 33) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 34) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },

                        {
                            extend: 'csv',
                            footer: true,
                            title: 'Solar Performance Reports Weekly SPV Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'Temp Corr. PR (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'Temp Corr. PR (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'Temp Corr. PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 32) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 33) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 34) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                       {
                           extend: 'colvis',
                           columnText: function (dt, idx, title) {
                               if (idx == 1) {
                                   return 'Capacity (MW)';
                               }
                               else if (idx == 2) {
                                   return 'Energy (in MU)  Tar';
                               }
                               else if (idx == 3) {
                                   return 'Energy (in MU)  Exp';
                               }
                               else if (idx == 4) {
                                   return 'Energy (in MU)  Act';
                               }
                               else if (idx == 5) {
                                   return 'Energy (in MU)  T.Var (%)';
                               }
                               else if (idx == 6) {
                                   return 'Energy (in MU)  E.Var (%)';
                               }
                               else if (idx == 7) {
                                   return 'Revenue (MINR) ';
                               }
                               else if (idx == 8) {
                                   return 'GHI (kWh/m^2)  Tar';
                               }
                               else if (idx == 9) {
                                   return 'GHI (kWh/m^2)  Act';
                               }
                               else if (idx == 10) {
                                   return 'GHI (kWh/m^2)  Var (%) ';
                               }
                               else if (idx == 11) {
                                   return 'POA (kWh/m^2)  Tar';
                               }
                               else if (idx == 12) {
                                   return 'POA (kWh/m^2)  Act ';
                               }
                               else if (idx == 13) {
                                   return 'POA (kWh/m^2) Var (%) ';
                               }
                               else if (idx == 14) {
                                   return 'GHI VS POA Gain (%)  Tar';
                               }
                               else if (idx == 15) {
                                   return 'GHI VS POA Gain (%)  Act ';
                               }
                               else if (idx == 16) {
                                   return 'GHI VS POA Gain(%)  Var (%) ';
                               }
                               else if (idx == 17) {
                                   return 'PLF (%)  Tar';
                               }
                               else if (idx == 18) {
                                   return 'PLF (%)  Act ';
                               }
                               else if (idx == 19) {
                                   return 'PLF (%)  Var (%) ';
                               }
                               else if (idx == 20) {
                                   return 'PR (%)  Tar';
                               }
                               else if (idx == 21) {
                                   return 'PR (%)  Act ';
                               }
                               else if (idx == 22) {
                                   return 'PR (%)  Var (%) ';
                               }
                               else if (idx == 23) {
                                   return 'Temp Corr. PR (%)  Tar';
                               }
                               else if (idx == 24) {
                                   return 'Temp Corr. PR (%)  Act ';
                               }
                               else if (idx == 25) {
                                   return 'Temp Corr. PR (%)  Var (%) ';
                               }
                               else if (idx == 26) {
                                   return 'MA (%)  Tar';
                               }
                               else if (idx == 27) {
                                   return 'MA (%)  Act ';
                               }
                               else if (idx == 28) {
                                   return 'MA (%)  Var (%) ';
                               }
                               else if (idx == 29) {
                                   return 'IGA (%)  Tar';
                               }
                               else if (idx == 30) {
                                   return 'IGA (%)  Act ';
                               }
                               else if (idx == 31) {
                                   return 'IGA (%)  Var (%) ';
                               }
                               else if (idx == 32) {
                                   return 'EGA (%)  Tar';
                               }
                               else if (idx == 33) {
                                   return 'EGA (%)  Act ';
                               }
                               else if (idx == 34) {
                                   return 'EGA (%)  Var (%) ';
                               }
                               else {
                                   return title;
                               }
                            }
                       }
                    ]                  
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dt-buttons > div > div > button ").addClass('btn btn-secondary');
                $(document).on("click", "div.dt-button-collection > div > button", function () {
                    if ($(this).hasClass("active")) {
                        $(this).css("background-color", "white");
                    } else {
                        $(this).css("background-color", "#31576d");
                    }
                });
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm  ');
                //$('#example1').removeClass('dataTable');
                $('#example1').wrap("<div class='scrolledTable'></div>");
                document.getElementById("loader").style.display = 'none';
                //It will convert div to image of PSPV
                var divPSPV = document.getElementById('divPSPV');
                html2canvas(divPSPV).then(function (canvas) {
                    // Get the image data as a URL
                    var imageData = canvas.toDataURL();
                    imgPSPV = imageData;

                });


                EnergyBarChartSPV(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels);
                BarChartSPV(target_pr, actual_pr, pas_pr_var, neg_pr_var, Levels, 'PR(%)');


            }
        });

    }
    function EnergyBarChartSPV(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels) {

        let chartStatus = Chart.getChart("energy_chart_pr_spv"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        let sampleChart = new Chart(document.getElementById("energy_chart_pr_spv"), {

            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'spv_en',
                    label: "Target Energy",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'spv_en',
                        label: "Actual Energy",
                        type: "bar",
                        backgroundColor: "#31576D",
                        backgroundColorHover: "#3e95cd",
                        data: actual_energy,
                       order: 1,
                        datalabels: {
                            anchor: 'center',
                            align: 'top',
                            color: 'white',
                            labels: {
                                title: {
                                    font: {
                                        weight: 'bold'

                                    }
                                },
                            },
                        },
                    }, {
                    yAxisID: 'spv_var',
                        label: "(+ve) %",
                    type: "bubble",
                        borderColor: "#86C466",
                        data: pas_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                    }, {
                    yAxisID: 'spv_var',
                        label: "(-ve) %",
                    type: "bubble",
                        borderColor: "#EE403D",
                        data: neg_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                    }

                ]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        ChartImages.push(url1);
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy (MUs)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    spv_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    spv_var: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }


        });

    }

    function BarChartSPV(target_wind, actual_wind, pas_wind_var, neg_wind_var, Levels, label) {
        let chartStatus = Chart.getChart("wind_chart_pr_spv"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        let sampleChart = new Chart(document.getElementById("wind_chart_pr_spv"), {
            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr',
                    label: "Target Irr ",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr',
                    label: "Actual Irr ",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }, {
                    yAxisID: 'pr_var',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        ChartImages.push(url1);
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irradiance (kWh/m^2)"
                    },
                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }
        });

    }
    //------------------------------------
    // Mothly Report SIte Wise
    function GetPerformanceBySite() {

        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var dateForFy = new Date(toDate);
        var fyear1 = getFinancialYear(dateForFy);
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        var reporthead = "Site Wise Reports";
        var Energy_Dataset = [];
        var Wind_Dataset = [];
        var actual_energy = [];
        var target_energy = [];
        var pas_energy_var = [];
        var neg_energy_var = [];

        var actual_pr = [];
        var target_pr = [];
        var pas_pr_var = [];
        var neg_pr_var = [];
        var Levels = [];

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarPRReportSiteWise", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&sitelist=' + site_ids,
            //url: "/WindReport/GetWindPRReportSiteWise?fy=" + fyear+" &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",
            datatype: "JSON",
            success: function (result, status, xhr) {
                // console.log(result);
                // var tbl = '<div class="text-center"><h5>' + reporthead + '</h5></div>';

                var tbl = '<table id="example4"  class="table table-bordered table-striped" style="width:150%">';
                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th rowspan="2">Site</th><th  rowspan="2">Capacity <br>(MW)</th>';
                tbl += '<th colspan="5" class="text-center">Gen nos. (MUs)</th><th>(±)Revenue</th>';
                tbl += '<th colspan="3" class="text-center">GHI (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">POA (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">GHI Vs POA Gain%</th>';
                tbl += '<th colspan="3" class="text-center">PLF (%)</th>';
                tbl += '<th colspan="3" class="text-center">PR (%)</th>';

                tbl += '<th colspan="3" class="text-center">Temp Corr. PR (%)</th>';

                tbl += '<th colspan="3" class="text-center">MA Actual (%)</th><th colspan="3" class="text-center">IGA (%)</th>';
                tbl += '<th colspan="3" class="text-center">EGA (%)</th></tr>';
                // tbl += '<tr><th>&nbsp;</th>';

                tbl += '<tr><th>Tar</th>';
                tbl += '<th>Exp</th>';
                tbl += '<th>Act JMR</th>';
                tbl += '<th>T.Var (%)</th>';
                tbl += '<th>E.Var (%)</th>';

                tbl += '<th>(MINR)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '</tr></thead>';


                if (result.length > 0) {

                    //let target_energy = [];
                    //let actual_energy = [];
                    //let pas_energy_var = [];
                    //let neg_energy_var = [];
                    //let target_wind = [];
                    //let actual_wind = [];
                    //let pas_wind_var = [];
                    //let neg_wind_var = [];
                    //console.log("Datatable");
                    let total_capacity = 0;
                    let total_tar_kwh = 0;
                    let total_act_kwh = 0;
                    let total_expected_kwh = 0;
                    let total_revenue = 0;
                    let total_capTarGhi = 0;
                    let total_tar_ghi = 0;
                    let total_act_ghi = 0;
                    let total_capTarPlf = 0;
                    let total_tar_plf = 0;
                    let total_act_plf = 0;
                    let total_capTarGain = 0;
                    let total_tar_gain = 0;
                    let total_act_gain = 0;
                    let total_capTarPoa = 0;
                    let total_tar_poa = 0;
                    let total_act_poa = 0;
                    let total_capTarPr = 0;
                    let total_tar_pr = 0;
                    let total_act_pr = 0;
                    let total_capTarMa = 0;
                    let total_tar_ma = 0;
                    let total_act_ma = 0;
                    let total_capTarIga = 0;
                    let total_tar_iga = 0;
                    let total_act_iga = 0;
                    let total_capTarEga = 0;
                    let total_tar_ega = 0;
                    let total_act_ega = 0;
                    let total_capActGhi = 0;
                    let total_capActPlf = 0;
                    let total_capActGain = 0;
                    let total_capActPoa = 0;
                    let total_capActPr = 0;
                    let total_capActMa = 0;
                    let total_capActIga = 0;
                    let total_capActEga = 0;

                    let total_capTarTCPr = 0;
                    let total_capActTCPr = 0;
                    let total_tar_TCpr = 0;
                    let total_act_TCpr = 0;

                    for (var i = 0; i < result.length; i++) {

                        let revenue = 0;
                        let jmr_var = 0;
                        let e_var = 0;
                        //let wind_var = 0;
                        let ghi_var = 0;
                        let poa_var = 0;
                        let plf_var = 0;
                        let ma_act_var = 0;
                        let iga_var = 0;
                        let ega_var = 0;
                        let pr_var = 0;
                        let gain_tar = 0;
                        let gain_act = 0;
                        let gain_var = 0;
                        let act_prval = 0;
                        let TCPr_var = 0;

                        revenue = (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                        if (result[i].act_kwh != 0 || result[i].tar_kwh != 0) {
                            jmr_var = ((result[i].act_kwh - result[i].tar_kwh) / result[i].tar_kwh) * 100;
                        }
                        if (result[i].expected_kwh != 0 || result[i].expected_kwh) {
                            e_var = ((result[i].act_kwh - (result[i].expected_kwh/1000000)) / (result[i].expected_kwh / 1000000) * 100);
                        }
                        if (result[i].pr_expected_kwh == 0 || result[i].act_kwh == 0) {
                            act_prval = 0;
                        }
                        else {
                            act_prval = (result[i].act_kwh / result[i].pr_expected_kwh) * 100;
                        }
                        if (result[i].tar_ghi != 0) {
                            ghi_var = ((result[i].act_ghi.toFixed(2) - result[i].tar_ghi.toFixed(2)) / result[i].tar_ghi.toFixed(2)) * 100;
                        }
                        if (result[i].tar_poa != 0) {
                            poa_var = ((result[i].act_poa.toFixed(2) - result[i].tar_poa.toFixed(2)) / result[i].tar_poa.toFixed(2)) * 100;
                        }

                        TCPr_var = (result[i].temp_corrected_pr - result[i].tar_pr)

                        pr_var = (act_prval - result[i].tar_pr);
                        plf_var = (result[i].act_plf - result[i].tar_plf);
                        ma_act_var = (result[i].act_ma - result[i].tar_ma);
                        iga_var = (result[i].act_iga - result[i].tar_iga);
                        ega_var = (result[i].act_ega - result[i].tar_ega);


                        if (result[i].tar_poa == 0 || result[i].tar_ghi == 0) {
                            gain_tar = 0;
                        } else {
                            gain_tar = (result[i].tar_poa / result[i].tar_ghi) * 100;
                        }
                        if (result[i].act_poa == 0 || result[i].act_ghi == 0) {
                            gain_act = 0;
                        } else {
                            gain_act = (result[i].act_poa / result[i].act_ghi) * 100;
                        }
                        if (gain_act == 0 || gain_tar == 0) {
                            gain_var = 0;
                        } else {
                            gain_var = ((gain_act - gain_tar)); /// gain_tar) * 100;
                        }


                        let pasitive;
                        let negative;
                        let e_pasitive;
                        let e_negative;
                        if (jmr_var < 0) {
                            negative = jmr_var.toFixed(2);
                            e_negative = jmr_var.toFixed(1);
                        }
                        else {
                            pasitive = jmr_var.toFixed(2);
                            e_pasitive = jmr_var.toFixed(1);
                        }
                        let pr_pasitive;
                        let pr_negative;
                        let pr_pasitive_p;
                        let pr_negative_p;
                        if (pr_var < 0) {
                            pr_negative = pr_var.toFixed(2);

                        }
                        else {
                            pr_pasitive = pr_var.toFixed(2);

                        }

                        if (poa_var < 0) {
                            pr_negative_p = pr_var.toFixed(1)
                        }
                        else {
                            pr_pasitive_p = pr_var.toFixed(1)
                        }

                        //console.log(result[i].tar_kwh);
                        target_energy.push((result[i].tar_kwh).toFixed(1));
                        actual_energy.push(result[i].act_kwh.toFixed(1));
                        pas_energy_var.push(pasitive);
                        neg_energy_var.push(negative);
                        Levels.push(result[i].site);

                        //target_pr.push(result[i].tar_pr.toFixed(1));
                        //actual_pr.push(result[i].act_pr.toFixed(1));
                        //pas_pr_var.push(pr_pasitive);
                        //neg_pr_var.push(pr_negative);

                        target_pr.push(result[i].tar_poa.toFixed(1));
                        actual_pr.push(result[i].act_poa.toFixed(1));
                        pas_pr_var.push(pr_pasitive);
                        neg_pr_var.push(pr_negative);
                        total_capacity += result[i].capacity;
                        total_tar_kwh += result[i].tar_kwh;
                        total_expected_kwh += result[i].expected_kwh/1000000;
                        total_act_kwh += result[i].act_kwh;
                        total_revenue += revenue;
                        total_tar_ghi += result[i].tar_ghi;
                        total_act_ghi += result[i].act_ghi;
                        total_tar_poa += result[i].tar_poa;
                        total_act_poa += result[i].act_poa;
                        total_tar_gain += gain_tar;
                        total_act_gain += gain_act;
                        total_tar_plf += result[i].tar_plf;
                        total_act_plf += result[i].act_plf;
                        total_tar_pr += result[i].tar_pr;
                        total_act_pr += act_prval;
                        total_tar_ma += result[i].tar_ma;
                        total_act_ma += result[i].act_ma;
                        total_tar_iga += result[i].tar_iga;
                        total_act_iga += result[i].act_iga;
                        total_tar_ega += result[i].tar_ega;
                        total_act_ega += result[i].act_ega;
                        total_capTarGhi += result[i].tar_ghi * result[i].capacity;
                        total_capTarPoa += result[i].tar_poa * result[i].capacity;
                        total_capTarPlf += result[i].tar_plf * result[i].capacity;
                        total_capTarPr += result[i].tar_pr * result[i].capacity;
                        total_capTarGain += gain_tar * result[i].capacity;
                        total_capTarMa += result[i].tar_ma * result[i].capacity
                        total_capTarIga += result[i].tar_iga * result[i].capacity;
                        total_capTarEga += result[i].tar_ega * result[i].capacity;
                        total_capActGhi += result[i].act_ghi * result[i].capacity;
                        total_capActPoa += result[i].act_poa * result[i].capacity;
                        total_capActPlf += result[i].act_plf * result[i].capacity;
                        total_capActPr += act_prval * result[i].capacity;
                        total_capActGain += gain_act * result[i].capacity;
                        total_capActMa += result[i].act_ma * result[i].capacity;
                        total_capActIga += result[i].act_iga * result[i].capacity;
                        total_capActEga += result[i].act_ega * result[i].capacity;

                        total_tar_TCpr += result[i].tar_pr;
                        total_act_TCpr += result[i].temp_corrected_pr;
                        total_capTarTCPr += result[i].tar_pr * result[i].capacity;
                        total_capActTCPr += result[i].temp_corrected_pr * result[i].capacity;

                        tbl += '<tr>';
                        tbl += '<td class="text-left">' + result[i].site + '</td>';
                        //tbl += '<td class="text-right">' + result[i].total_mw.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].capacity.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + (result[i].expected_kwh / 1000000).toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + jmr_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + e_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + revenue.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ghi_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + poa_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + gain_tar.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_act.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';



                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + act_prval.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].temp_corrected_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + TCPr_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ma_act_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + iga_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ega_var.toFixed(2) + '</td>';

                        tbl += '</tr>';
                    }

                    let avg_jmr_var = 0;
                    let avg_e_var = 0;//(((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                    let avg_tar_ghi = 0;
                    let avg_ghi_var = 0;
                    let avg_tar_plf = 0;
                    let avg_plf_var = 0;
                    let avg_tar_poa = 0;
                    let avg_poa_var = 0;
                    let avg_tar_gain = 0;
                    let avg_gain_var = 0;
                    let avg_tar_pr = 0;
                    let avg_pr_var = 0;
                    let avg_tar_ma = 0;
                    let avg_ma_var = 0;
                    let avg_tar_iga = 0;
                    let avg_iga_var = 0;
                    let avg_tar_ega = 0;
                    let avg_ega_var = 0;
                    let avg_act_ghi = 0
                    let avg_act_poa = 0;
                    let avg_act_plf = 0;
                    let avg_act_gain = 0;
                    let avg_act_pr = 0;
                    let avg_act_ma = 0;
                    let avg_act_iga = 0;
                    let avg_act_ega = 0;

                    let avg_tar_TCpr = 0;
                    let avg_TCpr_var = 0;

                    if (total_capacity != 0) {
                        avg_tar_ghi = (total_capTarGhi / total_capacity);
                        avg_tar_plf = total_capTarPlf / total_capacity;
                        avg_tar_poa = total_capTarPoa / total_capacity;
                        avg_tar_gain = total_capTarGain / total_capacity;
                        avg_tar_pr = total_capTarPr / total_capacity;
                        avg_tar_ma = total_capTarMa / total_capacity;
                        avg_tar_iga = total_capTarIga / total_capacity;
                        avg_tar_ega = total_capTarEga / total_capacity;
                        avg_act_ghi = total_capActGhi / total_capacity;
                        avg_act_plf = total_capActPlf / total_capacity;
                        avg_act_poa = total_capActPoa / total_capacity;
                        avg_act_gain = total_capActGain / total_capacity;
                        avg_act_pr = total_capActPr / total_capacity;
                        avg_act_ma = total_capActMa / total_capacity;
                        avg_act_iga = total_capActIga / total_capacity;
                        avg_act_ega = total_capActEga / total_capacity;

                        avg_tar_TCpr = total_capTarTCPr / total_capacity;
                        avg_act_TCpr = total_capActTCPr / total_capacity;
                    }
                    if (total_tar_kwh != 0) {
                        avg_jmr_var = (((total_act_kwh.toFixed(2) - total_tar_kwh.toFixed(2)) / total_tar_kwh.toFixed(2)) * 100)
                    }
                    if (total_expected_kwh != 0) {
                        avg_e_var = (((total_act_kwh.toFixed(2) - total_expected_kwh.toFixed(2)) / total_expected_kwh.toFixed(2)) * 100);
                    }
                    if (avg_tar_ghi != 0) {
                        avg_ghi_var = (((avg_act_ghi.toFixed(2) - avg_tar_ghi.toFixed(2)) / avg_tar_ghi.toFixed(2)) * 100);
                    }
                    if (avg_tar_poa != 0) {
                        avg_poa_var = (((avg_act_poa.toFixed(2) - avg_tar_poa.toFixed(2)) / avg_tar_poa.toFixed(2)) * 100);
                    }

                    avg_TCpr_var = (avg_act_TCpr.toFixed(2) - avg_tar_TCpr.toFixed(2));

                    avg_pr_var = (avg_act_pr.toFixed(2) - avg_tar_pr.toFixed(2));
                    avg_gain_var = (avg_act_gain.toFixed(2) - avg_tar_gain.toFixed(2));
                    avg_plf_var = (avg_act_plf.toFixed(2) - avg_tar_plf.toFixed(2));
                    avg_ma_var = (avg_act_ma.toFixed(2) - avg_tar_ma.toFixed(2));
                    avg_iga_var = (avg_act_iga.toFixed(2) - avg_tar_iga.toFixed(2));
                    avg_ega_var = (avg_act_ega.toFixed(2) - avg_tar_ega.toFixed(2));

                    tbl += '<tfoot><tr>';
                    tbl += '<th rowspan="1" colspan="1" style="width: 10%; font-weight: bold;">Grand Total</th>';
                    tbl += '<td class="text-right"><b>' + total_capacity.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_tar_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_expected_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_act_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_jmr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_e_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_revenue.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ghi_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_poa_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_gain_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_plf_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_pr_var.toFixed(2) + '</b></td>';

                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_TCpr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_TCpr_var.toFixed(2) + '</b></td>';

                    tbl += '<td class="text-right"><b>' + avg_tar_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ma_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_iga_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ega_var.toFixed(2) + '</b></td>';

                    tbl += '</tr></tfoot>';
                }
                else {
                    //console.log("Data not available");

                }
                tbl += '</table>';
                $("#reportsDailySite").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example4').DataTable({
                    dom: 'Bfrtip',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: true,
                    paging: true,
                    lengthChange: false,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: true,
                    responsive: false,
                    pageLength: 50,
                    //columnDefs: [
                    //    { targets: 1, className: 'btn btn-light' },
                    //],
                    buttons: [
                        {
                            extend: 'excel',
                            footer: true,
                            title: 'Solar Performance Reports Weekly Site Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'Temp Corr. PR (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'Temp Corr. PR (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'Temp Corr. PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 32) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 33) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 34) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                        {
                            extend: 'csv',
                            footer: true,
                            title: 'Solar Performance Reports Weekly Site Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'Temp Corr. PR (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'Temp Corr. PR (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'Temp Corr. PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 32) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 33) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 34) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                       // 'colvis'
                        {
                            extend: 'colvis',
                          //  columns: ':not(.noVis)',
                            columnText: function (dt, idx, title) {
                                if (idx == 1) {
                                    return 'Capacity (MW)';
                                }
                                else if (idx == 2) {
                                    return 'Energy (in MU)  Tar';
                                }
                                else if (idx == 3) {
                                    return 'Energy (in MU)  Exp';
                                }
                                else if (idx == 4) {
                                    return 'Energy (in MU)  Act';
                                }
                                else if (idx == 5) {
                                    return 'Energy (in MU)  T.Var (%)';
                                }
                                else if (idx == 6) {
                                    return 'Energy (in MU)  E.Var (%)';
                                }
                                else if (idx == 7) {
                                    return 'Revenue (MINR) ';
                                }
                                else if (idx == 8) {
                                    return 'GHI (kWh/m^2)  Tar';
                                }
                                else if (idx == 9) {
                                    return 'GHI (kWh/m^2)  Act';
                                }
                                else if (idx == 10) {
                                    return 'GHI (kWh/m^2)  Var (%) ';
                                }
                                else if (idx == 11) {
                                    return 'POA (kWh/m^2)  Tar';
                                }
                                else if (idx == 12) {
                                    return 'POA (kWh/m^2)  Act ';
                                }
                                else if (idx == 13) {
                                    return 'POA (kWh/m^2) Var (%) ';
                                }
                                else if (idx == 14) {
                                    return 'GHI VS POA Gain (%)  Tar';
                                }
                                else if (idx == 15) {
                                    return 'GHI VS POA Gain (%)  Act ';
                                }
                                else if (idx == 16) {
                                    return 'GHI VS POA Gain(%)  Var (%) ';
                                }
                                else if (idx == 17) {
                                    return 'PLF (%)  Tar';
                                }
                                else if (idx == 18) {
                                    return 'PLF (%)  Act ';
                                }
                                else if (idx == 19) {
                                    return 'PLF (%)  Var (%) ';
                                }
                                else if (idx == 20) {
                                    return 'PR (%)  Tar';
                                }
                                else if (idx == 21) {
                                    return 'PR (%)  Act ';
                                }
                                else if (idx == 22) {
                                    return 'PR (%)  Var (%) ';
                                }
                                else if (idx == 23) {
                                    return 'Temp Corr. PR (%)  Tar';
                                }
                                else if (idx == 24) {
                                    return 'Temp Corr. PR (%)  Act ';
                                }
                                else if (idx == 25) {
                                    return 'Temp Corr. PR (%)  Var (%) ';
                                }
                                else if (idx == 26) {
                                    return 'MA (%)  Tar';
                                }
                                else if (idx == 27) {
                                    return 'MA (%)  Act ';
                                }
                                else if (idx == 28) {
                                    return 'MA (%)  Var (%) ';
                                }
                                else if (idx == 29) {
                                    return 'IGA (%)  Tar';
                                }
                                else if (idx == 30) {
                                    return 'IGA (%)  Act ';
                                }
                                else if (idx == 31) {
                                    return 'IGA (%)  Var (%) ';
                                }
                                else if (idx == 32) {
                                    return 'EGA (%)  Tar';
                                }
                                else if (idx == 33) {
                                    return 'EGA (%)  Act ';
                                }
                                else if (idx == 34) {
                                    return 'EGA (%)  Var (%) ';
                                }
                                else {
                                    return title;
                                }

                            }
                        }
                    ]
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm');
                //$('#example2').removeClass('dataTable');
                $(document).on("click", "div.dt-button-collection > div > button", function () {
                    if ($(this).hasClass("active")) {
                        $(this).css("background-color", "white");
                    } else {
                        $(this).css("background-color", "#31576d");
                    }
                });
                $('#example2').wrap("<div class='scrolledTable'></div>");

                //It will convert div to image of PBS
                var divPBS = document.getElementById('divPBS');
                html2canvas(divPBS).then(function (canvas) {
                    // Get the image data as a URL
                    var imageData = canvas.toDataURL();
                    imgPBS = imageData;
                });


                EnergyBarChartSite(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels);
                BarChartSite(target_pr, actual_pr, pas_pr_var, neg_pr_var, Levels, 'PR(%)');
            }
        });
    }
    function EnergyBarChartSite(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels) {

        let chartStatus = Chart.getChart("energy_chart_pr_site"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        let sampleChart = new Chart(document.getElementById("energy_chart_pr_site"), {

            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr_en_p',
                    label: "Target Energy",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_en_p',
                    label: "Actual Energy",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var_p',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                }, {
                    yAxisID: 'pr_var_p',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        ChartImages.push(url1);
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy (MUs)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr_en_p: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var_p: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }


        });

    }

    function BarChartSite(target_wind, actual_wind, pas_wind_var, neg_wind_var, Levels, label) {
        let chartStatus = Chart.getChart("wind_chart_pr_site"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        let sampleChart = new Chart(document.getElementById("wind_chart_pr_site"), {
            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr_en_s',
                    label: "Target Irr",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_en_s',
                    label: "Actual Irr ",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var_s',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }, {
                    yAxisID: 'pr_var_s',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                animation: {
                    onComplete: (e) => {
                        var url1 = sampleChart.toBase64Image();
                        //console.log(url1);
                        ChartImages.push(url1);
                    }
                },
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irrdiance (kWh/m^2)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr_en_s: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var_s: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }
        });

    }



</script>
